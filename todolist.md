# WithUs 주문관리 시스템 개발 로드맵

## 📋 현재 상태 (1단계 완료)
- ✅ 기본 주문/상품/배송 관리 기능
- ✅ 네이버 쇼핑 API 연동
- ✅ 데이터베이스 캐시 우선 표시 기능
- ✅ 알림 시스템 (데스크탑 + 디스코드)
- ✅ 환경 설정 관리
- ✅ 모듈화된 탭 구조

## 🎯 2단계 개발 목표 (사용자 요구사항)

### Phase 1: 핵심 워크플로우 구현 (우선순위: 높음)
**예상 기간: 1-2개월**

#### 1.1 데이터베이스 스키마 확장
- [ ] 주문 테이블에 워크플로우 상태 컬럼 추가
  - `workflow_status` (신규주문, 발주확인, 발송처리, 배송완료, 정산완료)
  - `confirmation_date` (발주확인일)
  - `shipped_date` (발송일)
  - `delivered_date` (배송완료일)
  - `settlement_date` (정산일)
  - `settlement_amount` (정산금액)

- [ ] 택배사 관리 테이블 생성
  ```sql
  CREATE TABLE courier_companies (
      id INTEGER PRIMARY KEY,
      company_name TEXT NOT NULL,
      api_endpoint TEXT,
      api_key TEXT,
      active BOOLEAN DEFAULT TRUE
  );
  ```

- [ ] 송장 정보 테이블 생성
  ```sql
  CREATE TABLE shipping_labels (
      id INTEGER PRIMARY KEY,
      order_id TEXT,
      tracking_number TEXT UNIQUE,
      courier_company_id INTEGER,
      label_printed_date TEXT,
      api_sent_date TEXT
  );
  ```

#### 1.2 주문 처리 워크플로우 UI 구현
- [ ] 주문관리 탭에 워크플로우 단계별 처리 버튼 추가
  - 발주확인 버튼
  - 발송처리 버튼
  - 배송완료 버튼
  - 정산처리 버튼

- [ ] 주문 상태별 필터링 기능 강화
- [ ] 주문 처리 과정 타임라인 표시 기능
- [ ] 일괄 처리 기능 (다중 선택 후 일괄 상태 변경)

#### 1.3 기본 택배사 연동 기능
- [ ] 송장번호 입력 후 네이버 API 자동 전송 기능
- [ ] 택배사 선택 및 관리 기능
- [ ] 송장번호 유효성 검사 기능

### Phase 2: 택배 시스템 고도화 (우선순위: 중간)
**예상 기간: 2-3개월**

#### 2.1 택배사 API 연동
- [ ] CJ대한통운 API 연동
- [ ] 한진택배 API 연동
- [ ] 롯데택배 API 연동
- [ ] 택배사 API 통합 관리 클래스 구현

#### 2.2 송장 라벨 자동 생성 및 인쇄
- [ ] 송장 라벨 템플릿 생성
- [ ] PDF 송장 라벨 자동 생성
- [ ] 프린터 연동 및 자동 인쇄 기능
- [ ] 라벨 인쇄 기록 관리

#### 2.3 일괄 처리 기능 고도화
- [ ] Excel 파일로 송장번호 일괄 업로드
- [ ] 네이버 API 일괄 업데이트 기능
- [ ] 처리 결과 리포트 생성

### Phase 3: 정산 및 분석 기능 (우선순위: 중간)
**예상 기간: 1-2개월**

#### 3.1 월별 매출 정산 시스템
- [ ] 월별 정산 테이블 생성
  ```sql
  CREATE TABLE monthly_settlements (
      id INTEGER PRIMARY KEY,
      year INTEGER,
      month INTEGER,
      total_orders INTEGER DEFAULT 0,
      total_amount INTEGER DEFAULT 0,
      settlement_status TEXT DEFAULT 'pending',
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
  );
  ```

- [ ] 자동 정산 처리 로직 구현
- [ ] 정산 보고서 생성 (Excel, PDF)
- [ ] 정산 내역 검토 및 승인 기능

#### 3.2 매출 분석 대시보드
- [ ] 월별/일별 매출 차트
- [ ] 상품별 매출 분석
- [ ] 트렌드 분석 기능
- [ ] 매출 예측 기능

### Phase 4: 시스템 안정성 강화 (우선순위: 낮음)
**예상 기간: 1개월**

#### 4.1 로깅 시스템 고도화
- [ ] 구조화된 로깅 시스템 도입 (structlog)
- [ ] 로그 파일 로테이션 기능
- [ ] 에러 추적 및 알림 시스템
- [ ] 성능 모니터링 로그

#### 4.2 에러 복구 메커니즘
- [ ] API 호출 실패 시 재시도 로직
- [ ] 데이터베이스 연결 실패 처리
- [ ] 백업 및 복구 시스템
- [ ] 장애 발생 시 자동 복구 기능

#### 4.3 테스트 커버리지 확보
- [ ] 단위 테스트 작성 (pytest)
- [ ] 통합 테스트 작성
- [ ] API 테스트 자동화
- [ ] CI/CD 파이프라인 구축

## 🔧 기술적 개선사항

### 성능 최적화
- [ ] 비동기 처리 도입 (asyncio, aiohttp)
- [ ] 데이터베이스 연결 풀링
- [ ] 메모리 사용량 최적화
- [ ] 대용량 데이터 처리 최적화

### 보안 강화
- [ ] API 키 암호화 저장
- [ ] 데이터베이스 암호화
- [ ] 접근 권한 관리 시스템
- [ ] 감사 로그 기능

### UI/UX 개선
- [ ] 사용자 설정 개인화
- [ ] 키보드 단축키 지원
- [ ] 드래그 앤 드롭 기능

## 📅 개발 일정

### 2024년 Q1
- ✅ 1단계 기본 기능 완료
- ✅ 데이터베이스 캐시 우선 표시 기능

### 2024년 Q2
- 🎯 Phase 1: 핵심 워크플로우 구현
- 데이터베이스 스키마 확장
- 워크플로우 UI 구현

### 2024년 Q3
- 🎯 Phase 2: 택배 시스템 고도화
- 택배사 API 연동
- 송장 라벨 자동화

### 2024년 Q4
- 🎯 Phase 3: 정산 및 분석 기능
- 🎯 Phase 4: 시스템 안정성 강화

## 🚀 즉시 구현 가능한 개선사항

### 1. 데이터베이스 스키마 확장 (1-2일)
- 주문 테이블에 워크플로우 관련 컬럼 추가
- migration 스크립트 작성

### 2. 워크플로우 상태 관리 고도화 (3-5일)
- 더 세분화된 주문 상태 관리
- 상태 변경 이력 추적

### 3. UI 개선 (1주일)
- 워크플로우 단계별 처리 버튼 추가
- 상태별 색상 코딩
- 진행 상황 표시

### 4. 송장번호 관리 개선 (3-5일)
- 송장번호 입력 후 네이버 API 자동 전송
- 송장번호 유효성 검사
- 중복 송장번호 방지

## 📝 주의사항

### 개발 시 고려사항
- 기존 데이터 호환성 유지
- 사용자 경험 최우선 고려
- 단계적 배포로 안정성 확보
- 충분한 테스트 후 배포

### 리스크 관리
- API 변경 대응 방안 마련
- 데이터 백업 및 복구 계획
- 장애 대응 매뉴얼 작성
- 사용자 교육 및 지원 계획

## 📞 지원 및 문의
개발 과정에서 문의사항이나 요구사항 변경이 있을 경우, 각 Phase별로 검토 및 조정 가능합니다.

## 🌐 웹서비스 마이그레이션 계획 (EC2 백그라운드 서비스)

### 현재 데스크탑 앱 → 웹서비스 전환 분석

#### 📋 현재 구조 분석
- **UI Layer**: Tkinter 기반 데스크탑 GUI (4,913줄)
- **Business Logic**: 이미 분리된 모듈들 (API, DB, 알림, 모니터링)
- **Data Layer**: SQLite 로컬 데이터베이스
- **Background Service**: 스레드 기반 백그라운드 모니터링

#### 🎯 웹서비스 전환 목표
- **EC2에서 24/7 백그라운드 실행**
- **웹 기반 관리 인터페이스 제공**
- **RESTful API 서버로 확장**
- **다중 사용자 지원 (향후 확장)**

---

### 🏗️ 웹서비스 아키텍처 설계

#### Option 1: FastAPI + React (추천 ⭐)
```
┌─────────────────────────────────────────────────────────┐
│                    EC2 Instance                         │
├─────────────────────────────────────────────────────────┤
│  Frontend (React SPA)                                   │
│  ├── Dashboard (주문 현황)                                │
│  ├── Order Management (주문 관리)                         │
│  ├── Shipping Management (배송 관리)                      │
│  └── Settings (설정 관리)                                 │
├─────────────────────────────────────────────────────────┤
│  Backend (FastAPI)                                      │
│  ├── /api/orders/* (주문 API)                            │
│  ├── /api/products/* (상품 API)                          │
│  ├── /api/notifications/* (알림 API)                     │
│  ├── /api/settings/* (설정 API)                          │
│  └── /api/monitoring/* (모니터링 API)                     │
├─────────────────────────────────────────────────────────┤
│  Background Services (Celery + Redis)                   │
│  ├── Naver API Sync Task                               │
│  ├── Order Status Monitor                              │
│  ├── Notification Dispatcher                           │
│  └── Data Analytics                                    │
├─────────────────────────────────────────────────────────┤
│  Database (PostgreSQL)                                 │
│  ├── Orders Table                                      │
│  ├── Products Table                                    │
│  ├── Settings Table                                    │
│  └── Logs Table                                        │
└─────────────────────────────────────────────────────────┘
```

**장점:**
- 현대적인 스택 (FastAPI는 Python 생태계에서 빠른 성능)
- 기존 Python 코드 재사용 가능 (80% 이상)
- React는 사용자 친화적 UI 제공
- API 문서 자동 생성 (Swagger)

**단점:**
- React 개발 경험 필요
- 초기 설정 복잡도 높음

#### Option 2: Django + Bootstrap (빠른 개발)
```
┌─────────────────────────────────────────────────────────┐
│                    EC2 Instance                         │
├─────────────────────────────────────────────────────────┤
│  Frontend (Django Templates + Bootstrap)                │
│  ├── Dashboard View                                     │
│  ├── Order Management View                             │
│  ├── Shipping View                                     │
│  └── Settings View                                     │
├─────────────────────────────────────────────────────────┤
│  Backend (Django)                                      │
│  ├── orders/ (앱)                                       │
│  ├── products/ (앱)                                     │
│  ├── notifications/ (앱)                               │
│  └── monitoring/ (앱)                                  │
├─────────────────────────────────────────────────────────┤
│  Background Tasks (Django-Q)                           │
│  └── Scheduled Tasks                                   │
├─────────────────────────────────────────────────────────┤
│  Database (PostgreSQL)                                 │
└─────────────────────────────────────────────────────────┘
```

**장점:**
- 빠른 개발 가능 (Django Admin 활용)
- 기존 코드 쉽게 포팅 가능
- 단일 프레임워크로 완결성

**단점:**
- UI 확장성 제한
- 현대적 UX 구현 어려움

#### Option 3: Flask + Vue.js (경량화)
```
┌─────────────────────────────────────────────────────────┐
│  Frontend (Vue.js SPA)                                  │
│  Backend (Flask API)                                    │
│  Background (APScheduler)                               │
│  Database (PostgreSQL)                                  │
└─────────────────────────────────────────────────────────┘
```

**장점:**
- 가벼운 구조
- 학습 곡선 낮음

**단점:**
- 확장성 제한
- 복잡한 비동기 처리 어려움

---

### 🛠️ 마이그레이션 구체적 작업 계획

#### Phase 5: 웹서비스 기반 구조 설계 (2-3주)

##### 5.1 백엔드 API 서버 개발
- [ ] **FastAPI 기반 API 서버 구축**
  - 현재 Tkinter UI 로직을 REST API로 변환
  - `main.py`의 비즈니스 로직을 API 엔드포인트로 분리
  - 예상 작업시간: 20시간

- [ ] **데이터베이스 마이그레이션**
  - SQLite → PostgreSQL 마이그레이션
  - 스키마 최적화 및 인덱싱
  - 예상 작업시간: 8시간

- [ ] **인증 시스템 구축**
  - JWT 기반 인증 시스템
  - API 키 관리 시스템
  - 예상 작업시간: 12시간

##### 5.2 백그라운드 서비스 재구성
- [ ] **Celery 기반 백그라운드 작업**
  - 현재 `background_monitor.py`를 Celery Task로 변환
  - Redis를 메시지 브로커로 사용
  - 예상 작업시간: 15시간

- [ ] **스케줄링 시스템**
  - 주문 동기화, 상태 체크 등 정기 작업
  - Celery Beat를 사용한 크론 작업
  - 예상 작업시간: 8시간

##### 5.3 프론트엔드 개발
- [ ] **React 기반 웹 인터페이스**
  - 현재 Tkinter 탭 구조를 React 컴포넌트로 변환
  - 대시보드, 주문관리, 배송관리, 설정 페이지
  - 예상 작업시간: 40시간

- [ ] **실시간 업데이트 (WebSocket)**
  - 주문 상태 실시간 업데이트
  - 알림 실시간 표시
  - 예상 작업시간: 12시간

#### Phase 6: 인프라 구성 및 배포 (1-2주)

##### 6.1 EC2 환경 구성
- [ ] **EC2 인스턴스 설정**
  - Ubuntu 서버 설정
  - Docker 컨테이너화
  - 예상 작업시간: 8시간

- [ ] **서비스 구성**
  - Nginx (리버스 프록시)
  - PostgreSQL 설정
  - Redis 설정
  - 예상 작업시간: 12시간

##### 6.2 배포 자동화
- [ ] **CI/CD 파이프라인**
  - GitHub Actions
  - Docker 이미지 빌드 및 배포
  - 예상 작업시간: 10시간

- [ ] **모니터링 시스템**
  - 서버 상태 모니터링
  - 로그 관리 시스템
  - 예상 작업시간: 8시간

---

### 📦 기술 스택 상세

#### 추천 기술 스택 (Option 1 기준)

**Backend:**
```python
# requirements.txt 추가
fastapi==0.104.0
uvicorn==0.23.0
celery==5.3.0
redis==5.0.0
psycopg2-binary==2.9.7
sqlalchemy==2.0.21
alembic==1.12.0
pydantic==2.4.0
python-jose==3.3.0
passlib==1.7.4
```

**Frontend:**
```json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.15.0",
    "axios": "^1.5.0",
    "antd": "^5.9.0",
    "recharts": "^2.8.0",
    "socket.io-client": "^4.7.0"
  }
}
```

**Infrastructure:**
- **Web Server**: Nginx
- **Database**: PostgreSQL 14+
- **Cache**: Redis 7+
- **Container**: Docker
- **Cloud**: AWS EC2, RDS, ElastiCache

---

### 🔄 마이그레이션 단계별 전략

#### 단계 1: 하이브리드 운영 (1주)
- 기존 데스크탑 앱 유지
- 웹 API 서버 병렬 구축
- 데이터 동기화 테스트

#### 단계 2: 웹 우선 전환 (2주)
- 웹 인터페이스 주 사용
- 데스크탑 앱은 백업용
- 사용자 피드백 수집

#### 단계 3: 완전 전환 (1주)
- 데스크탑 앱 단계적 폐기
- 웹서비스 완전 이전
- 24/7 운영 시작

---

### 📊 예상 리소스

#### EC2 인스턴스 사양 (권장)
- **개발 환경**: t3.medium (2vCPU, 4GB RAM)
- **운영 환경**: t3.large (2vCPU, 8GB RAM) + RDS PostgreSQL
- **예상 월 비용**: $100-150

#### 개발 시간
- **Phase 5**: 115시간 (약 14-15 작업일)
- **Phase 6**: 38시간 (약 5 작업일)
- **총 웹서비스 마이그레이션**: 153시간 (약 19 작업일)

---

### 🎯 마이그레이션 후 이점

1. **확장성**: 다중 사용자 지원 가능
2. **접근성**: 어디서나 웹 브라우저로 접근
3. **안정성**: EC2에서 24/7 안정적 운영
4. **유지보수**: 중앙집중식 관리 및 업데이트
5. **모니터링**: 실시간 서버 상태 모니터링
6. **백업**: 클라우드 기반 자동 백업

---

## 🔄 전체 개발 로드맵 업데이트

### 기존 Phase 1-4: 데스크탑 앱 개선 (97시간)
### 추가 Phase 5-6: 웹서비스 마이그레이션 (153시간)

**총 예상 작업시간**: 250시간 (약 31-32 작업일)

---
**최종 업데이트**: 2025년 9월 10일  
**데스크탑 개선**: 97시간 (약 12-13 작업일)  
**웹서비스 마이그레이션**: 153시간 (약 19 작업일)  
**총 작업시간**: 250시간 (약 31-32 작업일)