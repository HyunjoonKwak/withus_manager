{% extends "base.html" %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="fas fa-cog text-primary"></i> ÏÑ§Ï†ï</h2>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="saveAllSettings()">
                        <i class="fas fa-save"></i> Î™®Îì† ÏÑ§Ï†ï Ï†ÄÏû•
                    </button>
                    <button class="btn btn-outline-secondary" onclick="resetToDefaults()">
                        <i class="fas fa-undo"></i> Í∏∞Î≥∏Í∞íÏúºÎ°ú Ï¥àÍ∏∞Ìôî
                    </button>
                </div>
            </div>

            <!-- ÏÑ§Ï†ï ÌÉ≠ -->
            <ul class="nav nav-tabs" id="settingsTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="basic-tab" data-bs-toggle="tab" data-bs-target="#basic" type="button" role="tab">
                        <i class="fas fa-tools"></i> Í∏∞Î≥∏ÏÑ§Ï†ï
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="conditions-tab" data-bs-toggle="tab" data-bs-target="#conditions" type="button" role="tab">
                        <i class="fas fa-filter"></i> Ï°∞Í±¥ÏÑ§Ï†ï
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="api-test-tab" data-bs-toggle="tab" data-bs-target="#api-test" type="button" role="tab">
                        <i class="fas fa-plug"></i> API ÌÖåÏä§Ìä∏
                    </button>
                </li>
            </ul>

            <!-- ÌÉ≠ Ïª®ÌÖêÏ∏† -->
            <div class="tab-content" id="settingsTabContent">
                <!-- Í∏∞Î≥∏ÏÑ§Ï†ï ÌÉ≠ -->
                <div class="tab-pane fade show active" id="basic" role="tabpanel">
                    <div class="mt-4">
                        <!-- API ÏÑ§Ï†ï -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5><i class="fas fa-plug text-warning"></i> ÎÑ§Ïù¥Î≤Ñ API ÏÑ§Ï†ï</h5>
                            </div>
                            <div class="card-body">
                                <!-- API ÏûêÍ≤©Ï¶ùÎ™Ö Ìé∏Ïßë ÏïàÎÇ¥ -->
                                <div class="alert alert-info mb-3">
                                    <div class="d-flex align-items-start">
                                        <i class="fas fa-info-circle text-info me-2 mt-1"></i>
                                        <div>
                                            <h6 class="alert-heading mb-2">üîê API ÏûêÍ≤©Ï¶ùÎ™Ö Î≥ÄÍ≤Ω Î∞©Î≤ï</h6>
                                            <p class="mb-2">Î≥¥ÏïàÏÉÅ ÏõπÏóêÏÑúÎäî ÌôïÏù∏ Î∞è ÌÖåÏä§Ìä∏Îßå Í∞ÄÎä•Ìï©ÎãàÎã§. Î≥ÄÍ≤ΩÏùÄ ÏÑúÎ≤ÑÏóêÏÑú ÏßÅÏ†ë ÌïòÏÑ∏Ïöî:</p>
                                            <ol class="mb-2">
                                                <li><strong>SSH Ï†ëÍ∑º:</strong> <code>nano .env</code> ÎòêÎäî <code>vi .env</code></li>
                                                <li><strong>ÌååÏùº ÏàòÏ†ï:</strong> NAVER_CLIENT_ID, NAVER_CLIENT_SECRET Í∞í Î≥ÄÍ≤Ω</li>
                                                <li><strong>ÏÑúÎπÑÏä§ Ïû¨ÏãúÏûë:</strong> <code>python web_server.py</code> Ïû¨Ïã§Ìñâ</li>
                                            </ol>
                                            <small class="text-muted">üí° ÌòÑÏû¨ Í∞íÏùÑ ÌôïÏù∏ÌïòÍ≥† Ïó∞Í≤∞ ÌÖåÏä§Ìä∏Îäî ÏïÑÎûòÏóêÏÑú Í∞ÄÎä•Ìï©ÎãàÎã§.</small>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="clientId" class="form-label">ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ID
                                            <span class="badge bg-info">ÌôïÏù∏Ïö©</span>
                                        </label>
                                        <input type="text" class="form-control" id="clientId" placeholder="ÎÑ§Ïù¥Î≤Ñ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ID">
                                        <small class="form-text text-muted">ÌòÑÏû¨ ÏÑ§Ï†ïÎêú Í∞í ÌôïÏù∏Ïö©</small>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="clientSecret" class="form-label">ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏãúÌÅ¨Î¶ø
                                            <span class="badge bg-info">ÌôïÏù∏Ïö©</span>
                                        </label>
                                        <div class="input-group">
                                            <input type="password" class="form-control" id="clientSecret" placeholder="ÎÑ§Ïù¥Î≤Ñ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏãúÌÅ¨Î¶ø">
                                            <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('clientSecret')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        <small class="form-text text-muted">ÌòÑÏû¨ ÏÑ§Ï†ïÎêú Í∞í ÌôïÏù∏Ïö©</small>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <button class="btn btn-primary" onclick="testApiConnection()">
                                        <i class="fas fa-flask"></i> API Ïó∞Í≤∞ ÌÖåÏä§Ìä∏
                                    </button>
                                    <span id="apiTestResult" class="ms-3"></span>
                                </div>
                            </div>
                        </div>

                        <!-- ÏïåÎ¶º ÏÑ§Ï†ï -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5><i class="fas fa-bell text-info"></i> ÏïåÎ¶º ÏÑ§Ï†ï</h5>
                            </div>
                            <div class="card-body">
                                <!-- Discord ÏÑ§Ï†ï ÏïàÎÇ¥ -->
                                <div class="alert alert-warning mb-3">
                                    <div class="d-flex align-items-start">
                                        <i class="fas fa-exclamation-triangle text-warning me-2 mt-1"></i>
                                        <div>
                                            <h6 class="alert-heading mb-2">üîí Discord Webhook URL Î≥ÄÍ≤Ω Î∞©Î≤ï</h6>
                                            <p class="mb-2">Î≥¥ÏïàÏÉÅ ÏõπÏóêÏÑúÎäî ÌôïÏù∏ Î∞è ÌÖåÏä§Ìä∏Îßå Í∞ÄÎä•Ìï©ÎãàÎã§. Î≥ÄÍ≤ΩÏùÄ ÏÑúÎ≤ÑÏóêÏÑú ÏßÅÏ†ë ÌïòÏÑ∏Ïöî:</p>
                                            <ol class="mb-2">
                                                <li><strong>SSH Ï†ëÍ∑º:</strong> <code>nano .env</code> ÎòêÎäî <code>vi .env</code></li>
                                                <li><strong>ÌååÏùº ÏàòÏ†ï:</strong> DISCORD_WEBHOOK_URL Í∞í Î≥ÄÍ≤Ω</li>
                                                <li><strong>ÏÑúÎπÑÏä§ Ïû¨ÏãúÏûë:</strong> <code>python web_server.py</code> Ïû¨Ïã§Ìñâ</li>
                                            </ol>
                                            <small class="text-muted">‚ö†Ô∏è Webhook URL ÎÖ∏Ï∂ú Ïãú Ïô∏Î∂ÄÏóêÏÑú Discord ÏÑúÎ≤ÑÏóê Ïä§Ìå∏ Î©îÏãúÏßÄ Ï†ÑÏÜ° Í∞ÄÎä•</small>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-8">
                                        <label for="discordWebhook" class="form-label">Discord ÏõπÌõÖ URL
                                            <span class="badge bg-info">ÌôïÏù∏Ïö©</span>
                                        </label>
                                        <div class="input-group">
                                            <input type="password" class="form-control" id="discordWebhook" placeholder="Discord ÏõπÌõÖ URL">
                                            <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('discordWebhook')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        <small class="form-text text-muted">ÌòÑÏû¨ ÏÑ§Ï†ïÎêú Í∞í ÌôïÏù∏Ïö©</small>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Discord ÏïåÎ¶º ÌôúÏÑ±Ìôî</label>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="discordEnabled">
                                            <label class="form-check-label" for="discordEnabled">
                                                Discord ÏïåÎ¶º ÏÇ¨Ïö©
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <button class="btn btn-primary" onclick="testDiscordNotification()">
                                        <i class="fab fa-discord"></i> Discord ÏïåÎ¶º ÌÖåÏä§Ìä∏
                                    </button>
                                    <span id="discordTestResult" class="ms-3"></span>
                                </div>
                            </div>
                        </div>

                        <!-- IP Í¥ÄÎ¶¨ -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5><i class="fas fa-globe text-success"></i> ÌóàÍ∞ÄÎêú Í≥µÏù∏ IP Í¥ÄÎ¶¨</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label">ÌòÑÏû¨ ÏÑúÎ≤Ñ Í≥µÏù∏ IP (ÎÑ§Ïù¥Î≤Ñ API Ìò∏Ï∂úÏö©):</label>
                                        <div class="d-flex align-items-center">
                                            <strong id="currentIP" class="me-2">ÌôïÏù∏ Ï§ë...</strong>
                                            <span id="ipStatus" class="badge bg-secondary me-2">ÌôïÏù∏ Ï§ë</span>
                                            <button class="btn btn-sm btn-outline-primary" onclick="refreshCurrentIP()">
                                                <i class="fas fa-sync-alt"></i> ÏÉàÎ°úÍ≥†Ïπ®
                                            </button>
                                        </div>
                                        <small class="form-text text-muted">Î∏åÎùºÏö∞Ï†Ä IPÍ∞Ä ÏïÑÎãå Ïã§Ï†ú API Ìò∏Ï∂ú ÏÑúÎ≤ÑÏùò IPÏûÖÎãàÎã§</small>
                                    </div>
                                    <div class="col-md-6">
                                        <button class="btn btn-sm btn-outline-info" onclick="showIPHelp()">
                                            <i class="fas fa-question-circle"></i> IP Í¥ÄÎ¶¨ ÎèÑÏõÄÎßê
                                        </button>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <label class="form-label">ÌóàÍ∞ÄÎêú IP Î™©Î°ù (ÏµúÎåÄ 5Í∞ú)
                                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="toggleIPList()">
                                                <i id="ipListIcon" class="fas fa-eye"></i> <span id="ipListText">Î™©Î°ù Î≥¥Í∏∞</span>
                                            </button>
                                        </label>
                                        <select class="form-control" id="ipList" size="5" style="height: 120px; display: none;">
                                        </select>
                                        <small class="form-text text-muted">Í∏∞Î≥∏Í∞í: 121.190.40.153, 175.125.204.97</small>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">IP Í¥ÄÎ¶¨</label>
                                        <div class="input-group mb-2">
                                            <input type="text" class="form-control" id="newIP" placeholder="ÏÉà IP Ï£ºÏÜå ÏûÖÎ†•">
                                            <button class="btn btn-outline-success" onclick="addIP()">
                                                <i class="fas fa-plus"></i> Ï∂îÍ∞Ä
                                            </button>
                                        </div>
                                        <div class="btn-group w-100">
                                            <button class="btn btn-outline-primary" onclick="addCurrentIP()">
                                                <i class="fas fa-map-marker-alt"></i> ÌòÑÏû¨IP Ï∂îÍ∞Ä
                                            </button>
                                            <button class="btn btn-outline-danger" onclick="deleteSelectedIP()">
                                                <i class="fas fa-trash"></i> ÏÑ†ÌÉù ÏÇ≠Ï†ú
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Ï°∞Í±¥ÏÑ§Ï†ï ÌÉ≠ -->
                <div class="tab-pane fade" id="conditions" role="tabpanel">
                    <div class="mt-4">
                        <!-- ÎåÄÏãúÎ≥¥Îìú ÏÑ§Ï†ï -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5><i class="fas fa-chart-line text-primary"></i> ÎåÄÏãúÎ≥¥Îìú ÏÑ§Ï†ï</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <label for="dashboardPeriod" class="form-label">ÎåÄÏãúÎ≥¥Îìú Ï°∞Ìöå Í∏∞Í∞Ñ (Ïùº)</label>
                                        <input type="number" class="form-control" id="dashboardPeriod" min="1" max="30" value="5">
                                        <div class="form-text">ÏµúÍ∑º Î©∞Ïπ†Ïùò Îç∞Ïù¥ÌÑ∞Î•º ÌëúÏãúÌï†ÏßÄ ÏÑ§Ï†ï</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="quickPeriod" class="form-label">Îπ†Î•∏ Í∏∞Í∞Ñ ÏÑ§Ï†ï (Ïùº)</label>
                                        <input type="number" class="form-control" id="quickPeriod" min="1" max="30" value="3">
                                        <div class="form-text">Îπ†Î•∏ Ï°∞ÌöåÏö© Í∏∞Î≥∏ Í∏∞Í∞Ñ</div>
                                    </div>
                                </div>

                                <hr class="my-3">
                                <h6 class="text-muted mb-3"><i class="fas fa-sync-alt"></i> Î™®ÎãàÌÑ∞ÎßÅ ÏÑ§Ï†ï</h6>

                                <div class="row">
                                    <div class="col-md-4">
                                        <label for="checkInterval" class="form-label">Ï≤¥ÌÅ¨ Í∞ÑÍ≤© (Ï¥à)</label>
                                        <input type="number" class="form-control" id="checkInterval" min="60" max="3600" value="300">
                                        <div class="form-text">Í∂åÏû•Í∞í: 300Ï¥à (5Î∂Ñ)</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="refreshInterval" class="form-label">ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ® Í∞ÑÍ≤© (Ï¥à)</label>
                                        <input type="number" class="form-control" id="refreshInterval" min="30" max="600" value="60">
                                        <div class="form-text">GUIÏóêÏÑú ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ® Í∞ÑÍ≤©</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ®</label>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="autoRefresh">
                                            <label class="form-check-label" for="autoRefresh">
                                                ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ® ÏÇ¨Ïö©
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Ï£ºÎ¨∏ ÏÉÅÌÉú ÏÑ§Ï†ï -->
                        <div class="card mb-3">
                            <div class="card-header py-2">
                                <h6 class="mb-0"><i class="fas fa-list-check text-warning"></i> Ï£ºÎ¨∏ ÏÉÅÌÉú Ï°∞Ìöå ÏÑ§Ï†ï</h6>
                            </div>
                            <div class="card-body py-2">
                                <div class="row g-2">
                                    <div class="col-md-2">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="orderStatus1" value="PAYMENT_WAITING" checked>
                                            <label class="form-check-label small" for="orderStatus1">Í≤∞Ï†úÎåÄÍ∏∞</label>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="orderStatus2" value="PAYED" checked>
                                            <label class="form-check-label small" for="orderStatus2">Í≤∞Ï†úÏôÑÎ£å</label>
                                        </div>
                                    </div>
                                    <div class="col-md-1">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="orderStatus3" value="DELIVERING" checked>
                                            <label class="form-check-label small" for="orderStatus3">Î∞∞ÏÜ°Ï§ë</label>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="orderStatus4" value="DELIVERED" checked>
                                            <label class="form-check-label small" for="orderStatus4">Î∞∞ÏÜ°ÏôÑÎ£å</label>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="orderStatus5" value="PURCHASE_DECIDED" checked>
                                            <label class="form-check-label small" for="orderStatus5">Íµ¨Îß§ÌôïÏ†ï</label>
                                        </div>
                                    </div>
                                    <div class="col-md-1">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="orderStatus6" value="CANCELED" checked>
                                            <label class="form-check-label small" for="orderStatus6">Ï∑®ÏÜå</label>
                                        </div>
                                    </div>
                                    <div class="col-md-1">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="orderStatus7" value="RETURNED" checked>
                                            <label class="form-check-label small" for="orderStatus7">Î∞òÌíà</label>
                                        </div>
                                    </div>
                                    <div class="col-md-1">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="orderStatus8" value="EXCHANGED" checked>
                                            <label class="form-check-label small" for="orderStatus8">ÍµêÌôò</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ÏÉÅÌíà ÏÉÅÌÉú ÏÑ§Ï†ï -->
                        <div class="card mb-3">
                            <div class="card-header py-2">
                                <h6 class="mb-0"><i class="fas fa-box text-info"></i> ÏÉÅÌíà ÏÉÅÌÉú Ï°∞Ìöå ÏÑ§Ï†ï</h6>
                            </div>
                            <div class="card-body py-2">
                                <div class="row g-2">
                                    <div class="col-md-2">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="productStatus1" value="SALE" checked>
                                            <label class="form-check-label small" for="productStatus1">ÌåêÎß§Ï§ë</label>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="productStatus2" value="WAIT" checked>
                                            <label class="form-check-label small" for="productStatus2">ÌåêÎß§ÎåÄÍ∏∞</label>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="productStatus3" value="OUTOFSTOCK" checked>
                                            <label class="form-check-label small" for="productStatus3">ÌíàÏ†à</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Ï£ºÎ¨∏ Ïª¨Îüº ÏÑ§Ï†ï -->
                        <div class="card mb-3">
                            <div class="card-header py-2">
                                <h6 class="mb-0"><i class="fas fa-columns text-secondary"></i> Ï£ºÎ¨∏ Ïª¨Îüº ÌëúÏãú ÏÑ§Ï†ï</h6>
                            </div>
                            <div class="card-body py-2">
                                <div class="row g-1">
                                    <div class="col-md-2">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="orderCol1" value="Ï£ºÎ¨∏ID" checked>
                                            <label class="form-check-label small" for="orderCol1">Ï£ºÎ¨∏ID</label>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="orderCol2" value="Ï£ºÎ¨∏Ïûê" checked>
                                            <label class="form-check-label small" for="orderCol2">Ï£ºÎ¨∏Ïûê</label>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="orderCol3" value="ÏÉÅÌíàÎ™Ö" checked>
                                            <label class="form-check-label small" for="orderCol3">ÏÉÅÌíàÎ™Ö</label>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="orderCol4" value="ÏòµÏÖòÏ†ïÎ≥¥" checked>
                                            <label class="form-check-label small" for="orderCol4">ÏòµÏÖòÏ†ïÎ≥¥</label>
                                        </div>
                                    </div>
                                    <div class="col-md-1">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="orderCol5" value="ÏàòÎüâ" checked>
                                            <label class="form-check-label small" for="orderCol5">ÏàòÎüâ</label>
                                        </div>
                                    </div>
                                    <div class="col-md-1">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="orderCol6" value="Í∏àÏï°" checked>
                                            <label class="form-check-label small" for="orderCol6">Í∏àÏï°</label>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="orderCol7" value="Î∞∞ÏÜ°ÏßÄÏ£ºÏÜå" checked>
                                            <label class="form-check-label small" for="orderCol7">Î∞∞ÏÜ°ÏßÄÏ£ºÏÜå</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="row g-1 mt-1">
                                    <div class="col-md-2">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="orderCol8" value="Î∞∞ÏÜ°ÏòàÏ†ïÏùº" checked>
                                            <label class="form-check-label small" for="orderCol8">Î∞∞ÏÜ°ÏòàÏ†ïÏùº</label>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="orderCol9" value="Ï£ºÎ¨∏ÏùºÏãú" checked>
                                            <label class="form-check-label small" for="orderCol9">Ï£ºÎ¨∏ÏùºÏãú</label>
                                        </div>
                                    </div>
                                    <div class="col-md-1">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="orderCol10" value="ÏÉÅÌÉú" checked>
                                            <label class="form-check-label small" for="orderCol10">ÏÉÅÌÉú</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ÌÉ≠Î≥Ñ Í∏∞Î≥∏ Í∏∞Í∞Ñ ÏÑ§Ï†ï -->
                        <div class="card mb-3">
                            <div class="card-header py-2">
                                <h6 class="mb-0"><i class="fas fa-calendar-alt text-purple"></i> ÌÉ≠Î≥Ñ Í∏∞Î≥∏ Í∏∞Í∞Ñ ÏÑ§Ï†ï (Ïùº)</h6>
                            </div>
                            <div class="card-body py-2">
                                <div class="row g-2">
                                    <div class="col-md-2">
                                        <label for="newOrderDays" class="form-label small">Ïã†Í∑úÏ£ºÎ¨∏</label>
                                        <input type="number" class="form-control form-control-sm" id="newOrderDays" min="1" max="90" value="3">
                                    </div>
                                    <div class="col-md-2">
                                        <label for="shippingPendingDays" class="form-label small">Î∞úÏÜ°ÎåÄÍ∏∞</label>
                                        <input type="number" class="form-control form-control-sm" id="shippingPendingDays" min="1" max="90" value="3">
                                    </div>
                                    <div class="col-md-2">
                                        <label for="shippingInProgressDays" class="form-label small">Î∞∞ÏÜ°Ï§ë</label>
                                        <input type="number" class="form-control form-control-sm" id="shippingInProgressDays" min="1" max="90" value="30">
                                    </div>
                                    <div class="col-md-2">
                                        <label for="shippingCompletedDays" class="form-label small">Î∞∞ÏÜ°ÏôÑÎ£å</label>
                                        <input type="number" class="form-control form-control-sm" id="shippingCompletedDays" min="1" max="90" value="7">
                                    </div>
                                    <div class="col-md-2">
                                        <label for="purchaseDecidedDays" class="form-label small">Íµ¨Îß§ÌôïÏ†ï</label>
                                        <input type="number" class="form-control form-control-sm" id="purchaseDecidedDays" min="1" max="90" value="3">
                                    </div>
                                    <div class="col-md-2">
                                        <label for="cancelDays" class="form-label small">Ï∑®ÏÜåÏ£ºÎ¨∏</label>
                                        <input type="number" class="form-control form-control-sm" id="cancelDays" min="1" max="90" value="30">
                                    </div>
                                </div>
                                <div class="row g-2 mt-1">
                                    <div class="col-md-2">
                                        <label for="returnExchangeDays" class="form-label small">Î∞òÌíà/ÍµêÌôò</label>
                                        <input type="number" class="form-control form-control-sm" id="returnExchangeDays" min="1" max="90" value="15">
                                    </div>
                                    <div class="col-md-2">
                                        <label for="cancelReturnExchangeDays" class="form-label small">Ï∑®ÏÜå/Î∞òÌíà/ÍµêÌôò</label>
                                        <input type="number" class="form-control form-control-sm" id="cancelReturnExchangeDays" min="1" max="90" value="7">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- API ÌÖåÏä§Ìä∏ ÌÉ≠ -->
                <div class="tab-pane fade" id="api-test" role="tabpanel">
                    <div class="mt-4">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-plug text-primary"></i> ÎÑ§Ïù¥Î≤Ñ API Ïó∞Í≤∞ ÌÖåÏä§Ìä∏</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6><i class="fas fa-key text-info"></i> API ÏûêÍ≤©Ï¶ùÎ™Ö ÏÉÅÌÉú</h6>
                                        <table class="table table-sm">
                                            <tr>
                                                <td>ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ID</td>
                                                <td>
                                                    {% if config.get('NAVER_CLIENT_ID') %}
                                                        <span class="badge bg-success">ÏÑ§Ï†ïÎê®</span>
                                                        <small class="text-muted">({{ config.get('NAVER_CLIENT_ID')[:8] }}...)</small>
                                                    {% else %}
                                                        <span class="badge bg-danger">ÎØ∏ÏÑ§Ï†ï</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏãúÌÅ¨Î¶ø</td>
                                                <td>
                                                    {% if config.get('NAVER_CLIENT_SECRET') %}
                                                        <span class="badge bg-success">ÏÑ§Ï†ïÎê®</span>
                                                        <small class="text-muted">(****)</small>
                                                    {% else %}
                                                        <span class="badge bg-danger">ÎØ∏ÏÑ§Ï†ï</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                    <div class="col-md-6">
                                        <h6><i class="fas fa-vial text-info"></i> Ïó∞Í≤∞ ÌÖåÏä§Ìä∏</h6>
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-outline-primary" onclick="testApiToken()">
                                                <i class="fas fa-key"></i> ÌÜ†ÌÅ∞ Î∞úÍ∏â ÌÖåÏä§Ìä∏
                                            </button>
                                            <button class="btn btn-outline-info" onclick="testOrdersApi()">
                                                <i class="fas fa-shopping-cart"></i> Ï£ºÎ¨∏ API ÌÖåÏä§Ìä∏
                                            </button>
                                            <button class="btn btn-outline-success" onclick="testProductsApi()">
                                                <i class="fas fa-box"></i> ÏÉÅÌíà API ÌÖåÏä§Ìä∏
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÌÖåÏä§Ìä∏ Í≤∞Í≥º ÌëúÏãú ÏòÅÏó≠ -->
                                <div class="mt-4">
                                    <h6><i class="fas fa-clipboard-list text-info"></i> ÌÖåÏä§Ìä∏ Í≤∞Í≥º</h6>
                                    <div id="api-test-results" class="border rounded p-3" style="background-color: #f8f9fa; min-height: 200px; font-family: monospace; font-size: 0.9em;">
                                        <div class="text-muted">ÌÖåÏä§Ìä∏ Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ API Ïó∞Í≤∞ÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî.</div>
                                    </div>
                                    <div class="mt-2">
                                        <button class="btn btn-sm btn-outline-secondary" onclick="clearTestResults()">
                                            <i class="fas fa-trash"></i> Í≤∞Í≥º ÏßÄÏö∞Í∏∞
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Ï†ÑÏó≠ Î≥ÄÏàò
let currentSettings = {};
let currentIP = '';

// ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ïã§Ìñâ
document.addEventListener('DOMContentLoaded', function() {
    loadAllSettings();
    updateSystemStatus();
    refreshCurrentIP();

    // Ï†ÄÏû•Îêú ÌôúÏÑ± ÌÉ≠ Î≥µÏõê
    restoreActiveTab();

    // ÌÉ≠ Î≥ÄÍ≤Ω Ïãú ÏÉÅÌÉú Ï†ÄÏû•
    setupTabStateTracking();

    // 10Ï¥àÎßàÎã§ ÏãúÏä§ÌÖú ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
    setInterval(updateSystemStatus, 10000);
});

// Î™®Îì† ÏÑ§Ï†ï Î°úÎìú
async function loadAllSettings() {
    try {
        const response = await fetch('/api/settings');
        const result = await response.json();

        if (result.success) {
            currentSettings = result.data;

            // Í∏∞Î≥∏ÏÑ§Ï†ï
            document.getElementById('clientId').value = currentSettings.client_id || '';
            document.getElementById('clientSecret').value = currentSettings.client_secret || '';
            document.getElementById('discordWebhook').value = currentSettings.discord_webhook || '';
            document.getElementById('discordEnabled').checked = currentSettings.discord_enabled || false;
            document.getElementById('checkInterval').value = currentSettings.check_interval || 300;
            document.getElementById('refreshInterval').value = currentSettings.refresh_interval || 60;
            document.getElementById('autoRefresh').checked = currentSettings.auto_refresh || false;

            // Ï°∞Í±¥ÏÑ§Ï†ï
            document.getElementById('dashboardPeriod').value = currentSettings.dashboard_period || 5;
            document.getElementById('quickPeriod').value = currentSettings.quick_period || 3;

            // ÌóàÏö©Îêú IP Î°úÎìú
            loadIPSettings();

            // ÌÉ≠Î≥Ñ Í∏∞Í∞Ñ ÏÑ§Ï†ï
            document.getElementById('newOrderDays').value = currentSettings.new_order_days || 3;
            document.getElementById('shippingPendingDays').value = currentSettings.shipping_pending_days || 3;
            document.getElementById('shippingInProgressDays').value = currentSettings.shipping_in_progress_days || 30;
            document.getElementById('shippingCompletedDays').value = currentSettings.shipping_completed_days || 7;
            document.getElementById('purchaseDecidedDays').value = currentSettings.purchase_decided_days || 3;
            document.getElementById('cancelDays').value = currentSettings.cancel_days || 30;
            document.getElementById('returnExchangeDays').value = currentSettings.return_exchange_days || 15;
            document.getElementById('cancelReturnExchangeDays').value = currentSettings.cancel_return_exchange_days || 7;

            // Ï≤¥ÌÅ¨Î∞ïÏä§ ÏÑ§Ï†ïÎì§ Î°úÎìú
            loadCheckboxSettings();
        }
    } catch (error) {
        showNotification('ÏÑ§Ï†ï Î°úÎìú Ï§ë Ïò§Î•ò Î∞úÏÉù: ' + error.message, 'error');
    }
}

// IP ÏÑ§Ï†ï Î°úÎìú
function loadIPSettings() {
    const allowedIPs = currentSettings.allowed_ips || '121.190.40.153,175.125.204.97';
    const ipList = allowedIPs.split(',').map(ip => ip.trim()).filter(ip => ip);

    const select = document.getElementById('ipList');
    select.innerHTML = '';

    ipList.forEach(ip => {
        const option = document.createElement('option');
        option.value = ip;
        option.textContent = ip;
        select.appendChild(option);
    });
}

// Ï≤¥ÌÅ¨Î∞ïÏä§ ÏÑ§Ï†ïÎì§ Î°úÎìú
function loadCheckboxSettings() {
    // Ï£ºÎ¨∏ ÏÉÅÌÉú - Î®ºÏ†Ä Î™®Îì† Ï≤¥ÌÅ¨Î∞ïÏä§ Ï¥àÍ∏∞Ìôî ÌõÑ Ï†ÄÏû•Îêú Í∞íÎßå Ï≤¥ÌÅ¨
    const orderStatuses = (currentSettings.order_status_types || 'PAYMENT_WAITING,PAYED,DELIVERING').split(',');
    for (let i = 1; i <= 8; i++) {
        const checkbox = document.getElementById(`orderStatus${i}`);
        if (checkbox) {
            checkbox.checked = orderStatuses.includes(checkbox.value);
        }
    }

    // ÏÉÅÌíà ÏÉÅÌÉú - Î®ºÏ†Ä Î™®Îì† Ï≤¥ÌÅ¨Î∞ïÏä§ Ï¥àÍ∏∞Ìôî ÌõÑ Ï†ÄÏû•Îêú Í∞íÎßå Ï≤¥ÌÅ¨
    const productStatuses = (currentSettings.product_status_types || 'SALE,WAIT,OUTOFSTOCK').split(',');
    for (let i = 1; i <= 3; i++) {
        const checkbox = document.getElementById(`productStatus${i}`);
        if (checkbox) {
            checkbox.checked = productStatuses.includes(checkbox.value);
        }
    }

    // Ï£ºÎ¨∏ Ïª¨Îüº - Î®ºÏ†Ä Î™®Îì† Ï≤¥ÌÅ¨Î∞ïÏä§ Ï¥àÍ∏∞Ìôî ÌõÑ Ï†ÄÏû•Îêú Í∞íÎßå Ï≤¥ÌÅ¨
    const orderColumns = (currentSettings.order_columns || 'Ï£ºÎ¨∏ID,Ï£ºÎ¨∏Ïûê,ÏÉÅÌíàÎ™Ö,ÏòµÏÖòÏ†ïÎ≥¥,ÏàòÎüâ,Í∏àÏï°,Î∞∞ÏÜ°ÏßÄÏ£ºÏÜå,Î∞∞ÏÜ°ÏòàÏ†ïÏùº,Ï£ºÎ¨∏ÏùºÏãú,ÏÉÅÌÉú').split(',');
    for (let i = 1; i <= 10; i++) {
        const checkbox = document.getElementById(`orderCol${i}`);
        if (checkbox) {
            checkbox.checked = orderColumns.includes(checkbox.value);
        }
    }
}

// ÌòÑÏû¨ ÏÑúÎ≤Ñ IP ÏÉàÎ°úÍ≥†Ïπ® (ÎÑ§Ïù¥Î≤Ñ API Ìò∏Ï∂úÏö©)
async function refreshCurrentIP() {
    try {
        document.getElementById('currentIP').textContent = 'ÌôïÏù∏ Ï§ë...';
        document.getElementById('ipStatus').className = 'badge bg-secondary';
        document.getElementById('ipStatus').textContent = 'ÌôïÏù∏ Ï§ë';

        // ÏÑúÎ≤ÑÏùò Ïã§Ï†ú IP ÌôïÏù∏ (ÎÑ§Ïù¥Î≤Ñ APIÍ∞Ä Ìò∏Ï∂úÎêòÎäî ÏÑúÎ≤Ñ IP)
        const response = await fetch('/api/current-ip');
        const result = await response.json();

        if (result.success) {
            currentIP = result.ip;
            document.getElementById('currentIP').textContent = `${currentIP} (ÏÑúÎ≤Ñ)`;

            // ÏÑúÎ≤ÑÏóêÏÑú Ïù¥ÎØ∏ ÌóàÍ∞Ä Ïó¨Î∂ÄÎ•º ÌôïÏù∏Ìï¥ÏÑú Î∞òÌôò
            if (result.is_allowed) {
                document.getElementById('ipStatus').className = 'badge bg-success';
                document.getElementById('ipStatus').textContent = '‚úì ÌóàÍ∞ÄÎê®';
            } else {
                document.getElementById('ipStatus').className = 'badge bg-warning';
                document.getElementById('ipStatus').textContent = '‚úó ÌóàÍ∞ÄÎêòÏßÄ ÏïäÏùå';
            }
        } else {
            document.getElementById('currentIP').textContent = 'ÌôïÏù∏ Ïã§Ìå®';
            document.getElementById('ipStatus').className = 'badge bg-danger';
            document.getElementById('ipStatus').textContent = 'Ïò§Î•ò';
            console.error('ÏÑúÎ≤Ñ IP ÌôïÏù∏ Ïã§Ìå®:', result.error);
        }
    } catch (error) {
        document.getElementById('currentIP').textContent = 'ÌôïÏù∏ Ïã§Ìå®';
        document.getElementById('ipStatus').className = 'badge bg-danger';
        document.getElementById('ipStatus').textContent = 'Ïò§Î•ò';
        console.error('IP ÌôïÏù∏ Ïò§Î•ò:', error);
    }
}

// IP Í¥ÄÎ¶¨ Ìï®ÏàòÎì§
function addIP() {
    const newIPInput = document.getElementById('newIP');
    const newIP = newIPInput.value.trim();

    if (!newIP) {
        showNotification('IP Ï£ºÏÜåÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.', 'warning');
        return;
    }

    if (!validateIPFormat(newIP)) {
        showNotification('Ïò¨Î∞îÎ•∏ IP Ï£ºÏÜå ÌòïÏãùÏù¥ ÏïÑÎãôÎãàÎã§.', 'error');
        return;
    }

    const select = document.getElementById('ipList');
    if (select.options.length >= 5) {
        showNotification('ÏµúÎåÄ 5Í∞úÏùò IPÎßå Í¥ÄÎ¶¨Ìï† Ïàò ÏûàÏäµÎãàÎã§.', 'warning');
        return;
    }

    // Ï§ëÎ≥µ ÌôïÏù∏
    for (let option of select.options) {
        if (option.value === newIP) {
            showNotification('Ïù¥ÎØ∏ Ï∂îÍ∞ÄÎêú IP Ï£ºÏÜåÏûÖÎãàÎã§.', 'warning');
            return;
        }
    }

    // IP Ï∂îÍ∞Ä
    const option = document.createElement('option');
    option.value = newIP;
    option.textContent = newIP;
    select.appendChild(option);

    newIPInput.value = '';
    showNotification('IPÍ∞Ä Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.', 'success');
}

function addCurrentIP() {
    if (!currentIP || currentIP === 'ÌôïÏù∏ Ï§ë...' || currentIP === 'ÌôïÏù∏ Ïã§Ìå®') {
        showNotification('ÌòÑÏû¨ IPÎ•º Î®ºÏ†Ä ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.', 'warning');
        return;
    }

    const select = document.getElementById('ipList');
    if (select.options.length >= 5) {
        showNotification('ÏµúÎåÄ 5Í∞úÏùò IPÎßå Í¥ÄÎ¶¨Ìï† Ïàò ÏûàÏäµÎãàÎã§.', 'warning');
        return;
    }

    // Ï§ëÎ≥µ ÌôïÏù∏
    for (let option of select.options) {
        if (option.value === currentIP) {
            showNotification('ÌòÑÏû¨ IPÎäî Ïù¥ÎØ∏ ÌóàÍ∞Ä Î™©Î°ùÏóê ÏûàÏäµÎãàÎã§.', 'info');
            return;
        }
    }

    // IP Ï∂îÍ∞Ä
    const option = document.createElement('option');
    option.value = currentIP;
    option.textContent = currentIP;
    select.appendChild(option);

    showNotification('ÌòÑÏû¨ IPÍ∞Ä ÌóàÍ∞Ä Î™©Î°ùÏóê Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.', 'success');

    // ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
    document.getElementById('ipStatus').className = 'badge bg-success';
    document.getElementById('ipStatus').textContent = '‚úì ÌóàÍ∞ÄÎê®';
}

function deleteSelectedIP() {
    const select = document.getElementById('ipList');
    const selectedIndex = select.selectedIndex;

    if (selectedIndex === -1) {
        showNotification('ÏÇ≠Ï†úÌï† IPÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.', 'warning');
        return;
    }

    if (confirm(`IP '${select.options[selectedIndex].value}'Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
        select.remove(selectedIndex);
        showNotification('IPÍ∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.', 'success');

        // ÌòÑÏû¨ IP ÏÉÅÌÉú Îã§Ïãú ÌôïÏù∏
        refreshCurrentIP();
    }
}

function validateIPFormat(ip) {
    const pattern = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
    return pattern.test(ip);
}

function showIPHelp() {
    const helpText = `üí° ÌóàÍ∞ÄÎêú Í≥µÏù∏ IP Í¥ÄÎ¶¨ ÎèÑÏõÄÎßê

üîπ ÌòÑÏû¨ ÏÑúÎ≤Ñ Í≥µÏù∏ IP
  - ÎÑ§Ïù¥Î≤Ñ APIÍ∞Ä Ïã§Ï†úÎ°ú Ìò∏Ï∂úÎêòÎäî ÏÑúÎ≤Ñ(EC2)Ïùò Í≥µÏù∏ IP Ï£ºÏÜåÏûÖÎãàÎã§
  - Î∏åÎùºÏö∞Ï†Ä IPÍ∞Ä ÏïÑÎãå ÏÑúÎ≤Ñ IPÎ•º ÌëúÏãúÌï©ÎãàÎã§
  - "ÏÉàÎ°úÍ≥†Ïπ®" Î≤ÑÌäºÏúºÎ°ú ÏµúÏã† Ï†ïÎ≥¥Î•º ÌôïÏù∏Ìï† Ïàò ÏûàÏäµÎãàÎã§

üîπ ÌóàÍ∞ÄÎêú IP Î™©Î°ù (ÏµúÎåÄ 5Í∞ú)
  - ÎÑ§Ïù¥Î≤Ñ Ïª§Î®∏Ïä§ API ÏÇ¨Ïö©Ïù¥ ÌóàÍ∞ÄÎêú IP Ï£ºÏÜå Î™©Î°ùÏûÖÎãàÎã§
  - Í∏∞Î≥∏Í∞í: 121.190.40.153, 175.125.204.97

üîπ IP Ï∂îÍ∞Ä/ÏÇ≠Ï†ú
  - "Ï∂îÍ∞Ä": ÏûÖÎ†•Ï∞ΩÏóê IP Ï£ºÏÜåÎ•º ÏûÖÎ†•ÌïòÏó¨ Ï∂îÍ∞Ä
  - "ÌòÑÏû¨IP Ï∂îÍ∞Ä": ÌòÑÏû¨ Í≥µÏù∏ IPÎ•º ÌóàÍ∞Ä Î™©Î°ùÏóê Ï∂îÍ∞Ä
  - "ÏÑ†ÌÉù ÏÇ≠Ï†ú": Î™©Î°ùÏóêÏÑú ÏÑ†ÌÉùÌïú IP ÏÇ≠Ï†ú

üîπ ÌóàÍ∞ÄÎêòÏßÄ ÏïäÏùÄ IPÎ°ú Ïã§Ìñâ Ïãú
  - Ï£ºÌô©ÏÉâ "‚úó ÌóàÍ∞ÄÎêòÏßÄ ÏïäÏùå" ÌëúÏãú
  - ÎÑ§Ïù¥Î≤Ñ Ïª§Î®∏Ïä§ API Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄÏóêÏÑú IP Ï∂îÍ∞Ä ÌïÑÏöî

üìã ÎÑ§Ïù¥Î≤Ñ Ïª§Î®∏Ïä§ API Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ
  - URL: https://apicenter.commerce.naver.com/ko/member/application/manage/list

‚ö†Ô∏è Ï£ºÏùòÏÇ¨Ìï≠
  - IP Î≥ÄÍ≤Ω ÌõÑ "Î™®Îì† ÏÑ§Ï†ï Ï†ÄÏû•" Î≤ÑÌäºÏùÑ ÎàåÎü¨ Ï†ÄÏû•ÌïòÏÑ∏Ïöî
  - ÎÑ§Ïù¥Î≤Ñ Ïª§Î®∏Ïä§ APIÏóêÏÑúÎèÑ ÎèôÏùºÌïú IPÎ•º ÌóàÍ∞ÄÌï¥Ïïº Ìï©ÎãàÎã§
  - ÏµúÎåÄ 5Í∞úÏùò IPÎßå Í¥ÄÎ¶¨Ìï† Ïàò ÏûàÏäµÎãàÎã§`;

    alert(helpText);
}

// ÏÑ§Ï†ï Ï†ÄÏû• Í¥ÄÎ†® Ìï®ÏàòÎì§
async function saveAllSettings() {
    try {
        const settings = {
            // Í∏∞Î≥∏ÏÑ§Ï†ï (Î≥¥Ïïà Í¥ÄÎ†® ÏûêÍ≤©Ï¶ùÎ™ÖÏùÄ Î™®Îëê Ï†úÏô∏)
            // client_id: document.getElementById('clientId').value,  // ÏùΩÍ∏∞ Ï†ÑÏö©
            // client_secret: document.getElementById('clientSecret').value,  // ÏùΩÍ∏∞ Ï†ÑÏö©
            // discord_webhook: document.getElementById('discordWebhook').value,  // ÏùΩÍ∏∞ Ï†ÑÏö©
            discord_enabled: document.getElementById('discordEnabled').checked,
            check_interval: parseInt(document.getElementById('checkInterval').value),
            refresh_interval: parseInt(document.getElementById('refreshInterval').value),
            auto_refresh: document.getElementById('autoRefresh').checked,

            // Ï°∞Í±¥ÏÑ§Ï†ï
            dashboard_period: parseInt(document.getElementById('dashboardPeriod').value),
            quick_period: parseInt(document.getElementById('quickPeriod').value),

            // IP ÏÑ§Ï†ï
            allowed_ips: Array.from(document.getElementById('ipList').options).map(opt => opt.value).join(','),

            // ÌÉ≠Î≥Ñ Í∏∞Í∞Ñ ÏÑ§Ï†ï
            new_order_days: parseInt(document.getElementById('newOrderDays').value),
            shipping_pending_days: parseInt(document.getElementById('shippingPendingDays').value),
            shipping_in_progress_days: parseInt(document.getElementById('shippingInProgressDays').value),
            shipping_completed_days: parseInt(document.getElementById('shippingCompletedDays').value),
            purchase_decided_days: parseInt(document.getElementById('purchaseDecidedDays').value),
            cancel_days: parseInt(document.getElementById('cancelDays').value),
            return_exchange_days: parseInt(document.getElementById('returnExchangeDays').value),
            cancel_return_exchange_days: parseInt(document.getElementById('cancelReturnExchangeDays').value),

            // Ï≤¥ÌÅ¨Î∞ïÏä§ ÏÑ§Ï†ïÎì§
            order_status_types: getCheckedValues('orderStatus', 8).join(','),
            product_status_types: getCheckedValues('productStatus', 3).join(','),
            order_columns: getCheckedValues('orderCol', 10).join(',')
        };

        const response = await fetch('/api/settings', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(settings)
        });

        const result = await response.json();

        if (result.success) {
            showNotification('Î™®Îì† ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.', 'success');
        } else {
            showNotification('ÏÑ§Ï†ï Ï†ÄÏû• Ïã§Ìå®: ' + result.error, 'error');
        }
    } catch (error) {
        showNotification('ÏÑ§Ï†ï Ï†ÄÏû• Ï§ë Ïò§Î•ò Î∞úÏÉù: ' + error.message, 'error');
    }
}

// Ï≤¥ÌÅ¨Îêú Í∞íÎì§ Í∞ÄÏ†∏Ïò§Í∏∞
function getCheckedValues(prefix, count) {
    const values = [];
    for (let i = 1; i <= count; i++) {
        const checkbox = document.getElementById(`${prefix}${i}`);
        if (checkbox && checkbox.checked) {
            values.push(checkbox.value);
        }
    }
    return values;
}

// ÌôúÏÑ± ÌÉ≠ ÏÉÅÌÉú Í¥ÄÎ¶¨ Ìï®ÏàòÎì§
function restoreActiveTab() {
    // URL Ìï¥ÏãúÍ∞Ä ÏûàÏúºÎ©¥ Ïö∞ÏÑ† Ï†ÅÏö© (Ïô∏Î∂Ä ÎßÅÌÅ¨Ïö©)
    const hash = window.location.hash.substring(1); // # Ï†úÍ±∞
    let targetTabId = null;

    if (hash === 'conditions') {
        targetTabId = 'conditions-tab';
    } else if (hash === 'api-test') {
        targetTabId = 'api-test-tab';
    } else if (hash === 'basic') {
        targetTabId = 'basic-tab';
    }

    // URL Ìï¥ÏãúÍ∞Ä ÏóÜÏúºÎ©¥ localStorageÏóêÏÑú Í∞ÄÏ†∏Ïò§Í∏∞
    if (!targetTabId) {
        targetTabId = localStorage.getItem('settings_active_tab');
    }

    if (targetTabId) {
        // ÏßÄÏ†ïÎêú ÌÉ≠ ÌôúÏÑ±Ìôî
        const targetTab = document.getElementById(targetTabId);
        const targetTabContent = document.querySelector(targetTab?.getAttribute('data-bs-target'));

        if (targetTab && targetTabContent) {
            // Î™®Îì† ÌÉ≠ ÎπÑÌôúÏÑ±Ìôî
            document.querySelectorAll('.nav-link').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active', 'show');
            });

            // ÏßÄÏ†ïÎêú ÌÉ≠ ÌôúÏÑ±Ìôî
            targetTab.classList.add('active');
            targetTabContent.classList.add('active', 'show');

            // localStorageÏóêÎèÑ Ï†ÄÏû•
            localStorage.setItem('settings_active_tab', targetTabId);
        }
    }
}

function setupTabStateTracking() {
    // Î™®Îì† ÌÉ≠ Î≤ÑÌäºÏóê ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
    document.querySelectorAll('[data-bs-toggle="tab"]').forEach(tabButton => {
        tabButton.addEventListener('click', function() {
            // ÌÅ¥Î¶≠Îêú ÌÉ≠Ïùò IDÎ•º localStorageÏóê Ï†ÄÏû•
            localStorage.setItem('settings_active_tab', this.id);
        });
    });
}

// API ÌÖåÏä§Ìä∏ Ìï®ÏàòÎì§
function addTestResult(message, type = 'info') {
    const resultsDiv = document.getElementById('api-test-results');
    const timestamp = new Date().toLocaleTimeString('ko-KR');

    const colorClass = type === 'success' ? 'text-success' :
                      type === 'error' ? 'text-danger' :
                      type === 'warning' ? 'text-warning' : 'text-info';

    const icon = type === 'success' ? 'fas fa-check' :
                type === 'error' ? 'fas fa-times' :
                type === 'warning' ? 'fas fa-exclamation-triangle' : 'fas fa-info-circle';

    const resultHtml = `<div class="mb-2">
        <span class="text-muted">[${timestamp}]</span>
        <span class="${colorClass}"><i class="${icon}"></i> ${message}</span>
    </div>`;

    resultsDiv.innerHTML += resultHtml;
    resultsDiv.scrollTop = resultsDiv.scrollHeight;
}

function clearTestResults() {
    const resultsDiv = document.getElementById('api-test-results');
    resultsDiv.innerHTML = '<div class="text-muted">ÌÖåÏä§Ìä∏ Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ API Ïó∞Í≤∞ÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî.</div>';
}

async function testApiToken() {
    const button = event.target;
    const originalHtml = button.innerHTML;

    try {
        button.disabled = true;
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ÌÖåÏä§Ìä∏ Ï§ë...';

        addTestResult('ÎÑ§Ïù¥Î≤Ñ API ÌÜ†ÌÅ∞ Î∞úÍ∏â ÌÖåÏä§Ìä∏ ÏãúÏûë...', 'info');

        const response = await fetch('/api/test-api-token', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        });

        const result = await response.json();

        if (result.success) {
            addTestResult('ÌÜ†ÌÅ∞ Î∞úÍ∏â ÏÑ±Í≥µ: ' + result.token.substring(0, 20) + '...', 'success');
        } else {
            addTestResult('ÌÜ†ÌÅ∞ Î∞úÍ∏â Ïã§Ìå®: ' + result.error, 'error');
        }
    } catch (error) {
        addTestResult('ÌÜ†ÌÅ∞ ÌÖåÏä§Ìä∏ Ï§ë Ïò§Î•ò: ' + error.message, 'error');
    } finally {
        button.disabled = false;
        button.innerHTML = originalHtml;
    }
}

async function testOrdersApi() {
    const button = event.target;
    const originalHtml = button.innerHTML;

    try {
        button.disabled = true;
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ÌÖåÏä§Ìä∏ Ï§ë...';

        addTestResult('Ï£ºÎ¨∏ API Ïó∞Í≤∞ ÌÖåÏä§Ìä∏ ÏãúÏûë...', 'info');

        const response = await fetch('/api/test-orders-api', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        });

        const result = await response.json();

        if (result.success) {
            addTestResult('Ï£ºÎ¨∏ API ÌÖåÏä§Ìä∏ ÏÑ±Í≥µ', 'success');
            if (result.order_count !== undefined) {
                addTestResult('Ï°∞ÌöåÎêú Ï£ºÎ¨∏ Ïàò: ' + result.order_count + 'Í±¥', 'info');
            }
        } else {
            addTestResult('Ï£ºÎ¨∏ API ÌÖåÏä§Ìä∏ Ïã§Ìå®: ' + result.error, 'error');
        }
    } catch (error) {
        addTestResult('Ï£ºÎ¨∏ API ÌÖåÏä§Ìä∏ Ï§ë Ïò§Î•ò: ' + error.message, 'error');
    } finally {
        button.disabled = false;
        button.innerHTML = originalHtml;
    }
}

async function testProductsApi() {
    const button = event.target;
    const originalHtml = button.innerHTML;

    try {
        button.disabled = true;
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ÌÖåÏä§Ìä∏ Ï§ë...';

        addTestResult('ÏÉÅÌíà API Ïó∞Í≤∞ ÌÖåÏä§Ìä∏ ÏãúÏûë...', 'info');

        const response = await fetch('/api/test-products-api', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        });

        const result = await response.json();

        if (result.success) {
            addTestResult('ÏÉÅÌíà API ÌÖåÏä§Ìä∏ ÏÑ±Í≥µ', 'success');
            if (result.product_count !== undefined) {
                addTestResult('Ï°∞ÌöåÎêú ÏÉÅÌíà Ïàò: ' + result.product_count + 'Í∞ú', 'info');
            }
        } else {
            addTestResult('ÏÉÅÌíà API ÌÖåÏä§Ìä∏ Ïã§Ìå®: ' + result.error, 'error');
        }
    } catch (error) {
        addTestResult('ÏÉÅÌíà API ÌÖåÏä§Ìä∏ Ï§ë Ïò§Î•ò: ' + error.message, 'error');
    } finally {
        button.disabled = false;
        button.innerHTML = originalHtml;
    }
}

async function testDiscordNotification() {
    const button = event.target;
    const resultSpan = document.getElementById('discordTestResult');

    button.disabled = true;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ÌÖåÏä§Ìä∏ Ï§ë...';
    resultSpan.innerHTML = '';

    try {
        const response = await fetch('/api/test-discord', {
            method: 'POST'
        });
        const result = await response.json();

        if (result.success) {
            resultSpan.innerHTML = '<span class="text-success"><i class="fas fa-check"></i> Discord ÏïåÎ¶º Ï†ÑÏÜ° ÏÑ±Í≥µ</span>';
        } else {
            resultSpan.innerHTML = '<span class="text-danger"><i class="fas fa-times"></i> Discord ÏïåÎ¶º Ïã§Ìå®: ' + result.error + '</span>';
        }
    } catch (error) {
        resultSpan.innerHTML = '<span class="text-danger"><i class="fas fa-times"></i> ÌÖåÏä§Ìä∏ Ï§ë Ïò§Î•ò: ' + error.message + '</span>';
    } finally {
        button.disabled = false;
        button.innerHTML = '<i class="fab fa-discord"></i> Discord ÏïåÎ¶º ÌÖåÏä§Ìä∏';
    }
}

// Í∏∞Î≥∏Í∞íÏúºÎ°ú Ï¥àÍ∏∞Ìôî
function resetToDefaults() {
    if (confirm('Î™®Îì† ÏÑ§Ï†ïÏùÑ Í∏∞Î≥∏Í∞íÏúºÎ°ú Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
        // Í∏∞Î≥∏Í∞í ÏÑ§Ï†ï
        document.getElementById('clientId').value = '';
        document.getElementById('clientSecret').value = '';
        document.getElementById('discordWebhook').value = '';
        document.getElementById('discordEnabled').checked = true;
        document.getElementById('checkInterval').value = 300;
        document.getElementById('refreshInterval').value = 60;
        document.getElementById('autoRefresh').checked = true;
        document.getElementById('dashboardPeriod').value = 5;
        document.getElementById('quickPeriod').value = 3;

        // IP Í∏∞Î≥∏Í∞í
        const select = document.getElementById('ipList');
        select.innerHTML = '';
        const defaultIPs = ['121.190.40.153', '175.125.204.97'];
        defaultIPs.forEach(ip => {
            const option = document.createElement('option');
            option.value = ip;
            option.textContent = ip;
            select.appendChild(option);
        });

        // ÌÉ≠Î≥Ñ Í∏∞Í∞Ñ Í∏∞Î≥∏Í∞í
        document.getElementById('newOrderDays').value = 3;
        document.getElementById('shippingPendingDays').value = 3;
        document.getElementById('shippingInProgressDays').value = 30;
        document.getElementById('shippingCompletedDays').value = 7;
        document.getElementById('purchaseDecidedDays').value = 3;
        document.getElementById('cancelDays').value = 30;
        document.getElementById('returnExchangeDays').value = 15;
        document.getElementById('cancelReturnExchangeDays').value = 7;

        // Î™®Îì† Ï≤¥ÌÅ¨Î∞ïÏä§ Ï≤¥ÌÅ¨
        for (let i = 1; i <= 8; i++) {
            const checkbox = document.getElementById(`orderStatus${i}`);
            if (checkbox) checkbox.checked = true;
        }
        for (let i = 1; i <= 3; i++) {
            const checkbox = document.getElementById(`productStatus${i}`);
            if (checkbox) checkbox.checked = true;
        }
        for (let i = 1; i <= 10; i++) {
            const checkbox = document.getElementById(`orderCol${i}`);
            if (checkbox) checkbox.checked = true;
        }

        showNotification('ÏÑ§Ï†ïÏù¥ Í∏∞Î≥∏Í∞íÏúºÎ°ú Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.', 'success');
    }
}

// API ÌÖåÏä§Ìä∏ Ìï®Ïàò
async function testApiConnection() {
    const button = event.target.closest('button');
    const resultSpan = document.getElementById('apiTestResult');
    const clientId = document.getElementById('clientId').value;
    const clientSecret = document.getElementById('clientSecret').value;

    if (!clientId || !clientSecret) {
        resultSpan.innerHTML = '<span class="text-warning"><i class="fas fa-exclamation-triangle"></i> ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏IDÏôÄ ÏãúÌÅ¨Î¶øÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî</span>';
        return;
    }

    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ÌÖåÏä§Ìä∏ Ï§ë...';
    button.disabled = true;
    resultSpan.innerHTML = '';

    try {
        const response = await fetch('/api/test-api-token', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                client_id: clientId,
                client_secret: clientSecret
            })
        });

        const result = await response.json();

        if (result.success) {
            resultSpan.innerHTML = '<span class="text-success"><i class="fas fa-check-circle"></i> Ïó∞Í≤∞ ÏÑ±Í≥µ!</span>';
        } else {
            resultSpan.innerHTML = `<span class="text-danger"><i class="fas fa-times-circle"></i> Ïó∞Í≤∞ Ïã§Ìå®: ${result.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'}</span>`;
        }
    } catch (error) {
        resultSpan.innerHTML = `<span class="text-danger"><i class="fas fa-times-circle"></i> Ïó∞Í≤∞ Ïò§Î•ò: ${error.message}</span>`;
    } finally {
        button.innerHTML = originalText;
        button.disabled = false;
    }
}

// Ïú†Ìã∏Î¶¨Ìã∞ Ìï®ÏàòÎì§
function togglePassword(inputId) {
    const input = document.getElementById(inputId);
    const icon = event.target.querySelector('i');

    if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
}

function showNotification(message, type = 'info') {
    const alertClass = type === 'success' ? 'alert-success' :
                      type === 'error' ? 'alert-danger' :
                      type === 'warning' ? 'alert-warning' : 'alert-info';

    const alert = document.createElement('div');
    alert.className = `alert ${alertClass} alert-dismissible fade show position-fixed`;
    alert.style.top = '20px';
    alert.style.right = '20px';
    alert.style.zIndex = '9999';
    alert.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;

    document.body.appendChild(alert);

    setTimeout(() => {
        if (alert.parentNode) {
            alert.parentNode.removeChild(alert);
        }
    }, 3000);
}

// ÏãúÏä§ÌÖú ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
async function updateSystemStatus() {
    try {
        const response = await fetch('/api/monitoring/status');
        const status = await response.json();

        if (status.success) {
            const monitoringBadge = document.getElementById('monitoringStatus');
            const lastCheckSpan = document.getElementById('lastCheck');

            if (status.monitoring_active) {
                monitoringBadge.className = 'badge bg-success';
                monitoringBadge.textContent = 'ÌôúÏÑ±Ìôî';
            } else {
                monitoringBadge.className = 'badge bg-warning';
                monitoringBadge.textContent = 'ÎπÑÌôúÏÑ±Ìôî';
            }

            lastCheckSpan.textContent = status.last_check || 'ÎØ∏ÌôïÏù∏';
        }
    } catch (error) {
        console.error('ÏãúÏä§ÌÖú ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ Ïò§Î•ò:', error);
    }
}

// IP Î™©Î°ù ÌÜ†Í∏Ä Ìï®Ïàò
function toggleIPList() {
    const ipList = document.getElementById('ipList');
    const icon = document.getElementById('ipListIcon');
    const text = document.getElementById('ipListText');

    if (ipList.style.display === 'none') {
        ipList.style.display = 'block';
        icon.className = 'fas fa-eye-slash';
        text.textContent = 'Î™©Î°ù Ïà®Í∏∞Í∏∞';
    } else {
        ipList.style.display = 'none';
        icon.className = 'fas fa-eye';
        text.textContent = 'Î™©Î°ù Î≥¥Í∏∞';
    }
}
</script>
{% endblock %}