{% extends "base.html" %}

{% block extra_head %}
<style>
    .help-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1.5rem;
        border-radius: 0.5rem;
        margin-bottom: 1.5rem;
    }
    .help-section {
        background: white;
        border-radius: 0.5rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        margin-bottom: 1.5rem;
    }
    .section-header {
        background-color: #f8f9fa;
        padding: 1rem 1.5rem;
        border-radius: 0.5rem 0.5rem 0 0;
        border-bottom: 1px solid #e9ecef;
        cursor: pointer;
        transition: background-color 0.2s;
    }
    .section-header:hover {
        background-color: #e9ecef;
    }
    .section-body {
        padding: 1.5rem;
    }
    .step-number {
        background: #007bff;
        color: white;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        margin-right: 1rem;
    }
    .feature-badge {
        background: #e3f2fd;
        color: #1976d2;
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-size: 0.875rem;
        margin: 0.125rem;
        display: inline-block;
    }
    .code-block {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 0.375rem;
        padding: 1rem;
        font-family: 'Courier New', monospace;
        font-size: 0.875rem;
        margin: 0.5rem 0;
    }
    .warning-box {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 0.375rem;
        padding: 1rem;
        margin: 1rem 0;
    }
    .info-box {
        background: #d1ecf1;
        border: 1px solid #bee5eb;
        border-radius: 0.375rem;
        padding: 1rem;
        margin: 1rem 0;
    }
    .toc {
        background: #f8f9fa;
        border-radius: 0.5rem;
        padding: 1.5rem;
        margin-bottom: 2rem;
    }
    .toc ul {
        margin-bottom: 0;
    }
    .toc a {
        text-decoration: none;
        color: #007bff;
    }
    .toc a:hover {
        text-decoration: underline;
    }
</style>
{% endblock %}

{% block content %}
<div class="help-header">
    <h2 class="h4 mb-2">
        <i class="fas fa-question-circle"></i> {{ title }}
    </h2>
    <p class="mb-0">WithUs 주문관리시스템 사용법과 문제해결 방법을 안내합니다.</p>
</div>

<!-- 목차 -->
<div class="toc">
    <h5><i class="fas fa-list"></i> 목차</h5>
    <div class="row">
        <div class="col-md-6">
            <ul class="list-unstyled">
                <li><a href="#getting-started">1. 시작하기</a></li>
                <li><a href="#order-management">2. 주문 관리</a></li>
                <li><a href="#product-management">3. 상품 관리</a></li>
                <li><a href="#settings">4. 설정</a></li>
            </ul>
        </div>
        <div class="col-md-6">
            <ul class="list-unstyled">
                <li><a href="#api-setup">5. API 설정</a></li>
                <li><a href="#notifications">6. 알림 설정</a></li>
                <li><a href="#troubleshooting">7. 문제해결</a></li>
                <li><a href="#faq">8. 자주 묻는 질문</a></li>
            </ul>
        </div>
    </div>
</div>

<!-- 시작하기 -->
<div class="help-section" id="getting-started">
    <div class="section-header" onclick="toggleSection('getting-started-body')">
        <h5 class="mb-0">
            <i class="fas fa-play-circle"></i> 1. 시작하기
            <i class="fas fa-chevron-down float-end"></i>
        </h5>
    </div>
    <div class="section-body" id="getting-started-body">
        <h6><span class="step-number">1</span>시스템 개요</h6>
        <p>WithUs 주문관리시스템은 네이버 쇼핑몰 운영을 위한 통합 관리 도구입니다.</p>

        <div class="info-box">
            <strong><i class="fas fa-info-circle"></i> 주요 기능</strong><br>
            <span class="feature-badge">주문 관리</span>
            <span class="feature-badge">상품 관리</span>
            <span class="feature-badge">재고 관리</span>
            <span class="feature-badge">알림 시스템</span>
            <span class="feature-badge">자동화</span>
            <span class="feature-badge">API 연동</span>
        </div>

        <h6><span class="step-number">2</span>첫 설정</h6>
        <ol>
            <li><strong>네이버 API 설정</strong>: 설정 메뉴에서 Client ID와 Client Secret을 입력</li>
            <li><strong>Discord 웹훅 설정</strong> (선택사항): 알림을 받을 Discord 채널 웹훅 URL 입력</li>
            <li><strong>모니터링 활성화</strong>: 자동 주문 확인을 위한 모니터링 설정</li>
        </ol>

        <div class="warning-box">
            <strong><i class="fas fa-exclamation-triangle"></i> 중요</strong><br>
            네이버 API 설정 없이는 주문 조회 기능을 사용할 수 없습니다. 반드시 먼저 API 설정을 완료하세요.
        </div>
    </div>
</div>

<!-- 주문 관리 -->
<div class="help-section" id="order-management">
    <div class="section-header" onclick="toggleSection('order-management-body')">
        <h5 class="mb-0">
            <i class="fas fa-box"></i> 2. 주문 관리
            <i class="fas fa-chevron-down float-end"></i>
        </h5>
    </div>
    <div class="section-body" id="order-management-body" style="display: none;">
        <h6><span class="step-number">1</span>주문 상태별 관리</h6>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>상태</th>
                    <th>설명</th>
                    <th>가능한 액션</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="badge bg-success">신규주문</span></td>
                    <td>결제 완료 후 판매자 확인 전</td>
                    <td>주문확인, 발송지연안내, 판매취소</td>
                </tr>
                <tr>
                    <td><span class="badge bg-primary">발송대기</span></td>
                    <td>주문 확인 후 발송 처리 전</td>
                    <td>발송처리 (송장번호 입력)</td>
                </tr>
                <tr>
                    <td><span class="badge bg-info">배송중</span></td>
                    <td>택배사 인도 후 배송중</td>
                    <td>배송 상태 추적</td>
                </tr>
                <tr>
                    <td><span class="badge bg-secondary">배송완료</span></td>
                    <td>고객 배송 완료</td>
                    <td>구매확정 독려</td>
                </tr>
                <tr>
                    <td><span class="badge bg-dark">구매확정</span></td>
                    <td>고객 구매확정 완료</td>
                    <td>정산 대기</td>
                </tr>
            </tbody>
        </table>

        <h6><span class="step-number">2</span>주문 조회 방법</h6>
        <ol>
            <li>좌측 메뉴에서 원하는 주문 상태 선택</li>
            <li>날짜 범위와 조회 조건 설정</li>
            <li>"조회" 버튼 클릭하여 목록 확인</li>
            <li>필요시 Excel로 내보내기 가능</li>
        </ol>

        <h6><span class="step-number">3</span>일괄 처리</h6>
        <p>여러 주문을 한번에 처리하려면 체크박스를 선택한 후 상단의 일괄처리 버튼을 이용하세요.</p>
    </div>
</div>

<!-- 상품 관리 -->
<div class="help-section" id="product-management">
    <div class="section-header" onclick="toggleSection('product-management-body')">
        <h5 class="mb-0">
            <i class="fas fa-tags"></i> 3. 상품 관리
            <i class="fas fa-chevron-down float-end"></i>
        </h5>
    </div>
    <div class="section-body" id="product-management-body" style="display: none;">
        <h6><span class="step-number">1</span>상품 목록 조회</h6>
        <ul>
            <li>상품명으로 검색 가능</li>
            <li>카테고리별 필터링</li>
            <li>재고 상태별 필터링</li>
            <li>판매 상태별 필터링</li>
        </ul>

        <h6><span class="step-number">2</span>재고 관리</h6>
        <div class="info-box">
            <strong>재고 상태 표시</strong><br>
            <span class="badge" style="background-color: #a7f0ba; color: #00b894;">충분 (100+)</span>
            <span class="badge" style="background-color: #81ecec; color: #00b894;">보통 (50-99)</span>
            <span class="badge" style="background-color: #ffeaa7; color: #d63031;">부족 (1-49)</span>
            <span class="badge" style="background-color: #fab1a0; color: #e17055;">품절 (0)</span>
        </div>

        <h6><span class="step-number">3</span>재고 알림 설정</h6>
        <p>조건설정에서 재고 부족 알림을 활성화하면 설정한 수량 이하가 될 때 자동으로 알림을 받을 수 있습니다.</p>
    </div>
</div>

<!-- 설정 -->
<div class="help-section" id="settings">
    <div class="section-header" onclick="toggleSection('settings-body')">
        <h5 class="mb-0">
            <i class="fas fa-cog"></i> 4. 설정
            <i class="fas fa-chevron-down float-end"></i>
        </h5>
    </div>
    <div class="section-body" id="settings-body" style="display: none;">
        <h6><span class="step-number">1</span>기본 설정</h6>
        <ul>
            <li><strong>네이버 API 설정</strong>: Client ID, Client Secret</li>
            <li><strong>Discord 알림</strong>: 웹훅 URL 및 알림 활성화</li>
            <li><strong>모니터링</strong>: 자동 확인 주기 설정</li>
        </ul>

        <h6><span class="step-number">2</span>조건 설정</h6>
        <ul>
            <li><strong>자동화 규칙</strong>: 주문 자동 확인, 재고 알림 등</li>
            <li><strong>알림 조건</strong>: 상태별 알림 설정</li>
            <li><strong>IP 관리</strong>: API 허용 IP 주소 관리</li>
        </ul>
    </div>
</div>

<!-- API 설정 -->
<div class="help-section" id="api-setup">
    <div class="section-header" onclick="toggleSection('api-setup-body')">
        <h5 class="mb-0">
            <i class="fas fa-plug"></i> 5. API 설정
            <i class="fas fa-chevron-down float-end"></i>
        </h5>
    </div>
    <div class="section-body" id="api-setup-body" style="display: none;">
        <h6><span class="step-number">1</span>네이버 API 키 발급</h6>
        <ol>
            <li>네이버 개발자 센터 접속 (developers.naver.com)</li>
            <li>쇼핑 API 신청</li>
            <li>Client ID와 Client Secret 발급받기</li>
            <li>서비스 URL에 현재 도메인 추가</li>
        </ol>

        <h6><span class="step-number">2</span>API 설정 입력</h6>
        <div class="code-block">
설정 → 기본설정에서 입력:
- Client ID: 발급받은 클라이언트 ID
- Client Secret: 발급받은 클라이언트 시크릿
        </div>

        <h6><span class="step-number">3</span>IP 허용 설정</h6>
        <p>네이버 API는 등록된 IP에서만 호출 가능합니다. 조건설정에서 현재 서버 IP를 확인하고 네이버 개발자 센터에서 허용 IP로 등록하세요.</p>

        <div class="warning-box">
            <strong><i class="fas fa-exclamation-triangle"></i> 주의사항</strong><br>
            API 키는 보안이 중요합니다. 외부에 노출되지 않도록 주의하세요.
        </div>
    </div>
</div>

<!-- 알림 설정 -->
<div class="help-section" id="notifications">
    <div class="section-header" onclick="toggleSection('notifications-body')">
        <h5 class="mb-0">
            <i class="fas fa-bell"></i> 6. 알림 설정
            <i class="fas fa-chevron-down float-end"></i>
        </h5>
    </div>
    <div class="section-body" id="notifications-body" style="display: none;">
        <h6><span class="step-number">1</span>Discord 웹훅 설정</h6>
        <ol>
            <li>Discord에서 알림받을 채널 선택</li>
            <li>채널 설정 → 연동 → 웹훅 만들기</li>
            <li>웹훅 URL 복사</li>
            <li>조건설정에서 Discord 웹훅 URL 입력</li>
        </ol>

        <h6><span class="step-number">2</span>알림 종류</h6>
        <ul>
            <li><strong>주문 상태 변화</strong>: 신규주문, 배송완료 등</li>
            <li><strong>재고 부족</strong>: 설정한 수량 이하</li>
            <li><strong>시스템 오류</strong>: API 연결 실패 등</li>
            <li><strong>모니터링 결과</strong>: 정기 확인 결과</li>
        </ul>

        <h6><span class="step-number">3</span>알림 테스트</h6>
        <p>API 테스트 페이지에서 알림 전송을 테스트해볼 수 있습니다.</p>
    </div>
</div>

<!-- 문제해결 -->
<div class="help-section" id="troubleshooting">
    <div class="section-header" onclick="toggleSection('troubleshooting-body')">
        <h5 class="mb-0">
            <i class="fas fa-tools"></i> 7. 문제해결
            <i class="fas fa-chevron-down float-end"></i>
        </h5>
    </div>
    <div class="section-body" id="troubleshooting-body" style="display: none;">
        <h6><span class="step-number">1</span>주문이 조회되지 않는 경우</h6>
        <ul>
            <li>네이버 API 설정이 올바른지 확인</li>
            <li>IP 허용 상태 확인</li>
            <li>날짜 범위 확인</li>
            <li>API 테스트에서 연결 상태 확인</li>
        </ul>

        <h6><span class="step-number">2</span>알림이 오지 않는 경우</h6>
        <ul>
            <li>Discord 웹훅 URL이 올바른지 확인</li>
            <li>알림 설정이 활성화되어 있는지 확인</li>
            <li>모니터링이 활성화되어 있는지 확인</li>
            <li>API 테스트에서 알림 테스트 실행</li>
        </ul>

        <h6><span class="step-number">3</span>일반적인 오류</h6>
        <div class="code-block">
오류: "API 인증 실패"
해결: Client ID와 Client Secret 재확인

오류: "IP가 허용되지 않음"
해결: 네이버 개발자 센터에서 현재 IP 추가

오류: "주문 조회 실패"
해결: 날짜 범위와 상태 조건 재설정
        </div>
    </div>
</div>

<!-- 자주 묻는 질문 -->
<div class="help-section" id="faq">
    <div class="section-header" onclick="toggleSection('faq-body')">
        <h5 class="mb-0">
            <i class="fas fa-question"></i> 8. 자주 묻는 질문
            <i class="fas fa-chevron-down float-end"></i>
        </h5>
    </div>
    <div class="section-body" id="faq-body" style="display: none;">
        <div class="accordion" id="faqAccordion">
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                        Q: 여러 네이버 쇼핑몰을 동시에 관리할 수 있나요?
                    </button>
                </h2>
                <div id="faq1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        현재 버전에서는 하나의 네이버 쇼핑몰만 관리할 수 있습니다. 여러 쇼핑몰 관리는 향후 업데이트에서 지원될 예정입니다.
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                        Q: 데이터는 얼마나 자주 동기화되나요?
                    </button>
                </h2>
                <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        모니터링이 활성화된 경우 설정한 간격(기본 5분)마다 자동으로 동기화됩니다. 수동으로 "새로고침" 버튼을 눌러 즉시 동기화할 수도 있습니다.
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                        Q: Excel 내보내기는 어떻게 사용하나요?
                    </button>
                </h2>
                <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        각 주문 관리 페이지에서 "Excel" 버튼을 클릭하면 현재 조회된 주문 목록을 Excel 파일로 다운로드할 수 있습니다.
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq4">
                        Q: 시스템을 24시간 운영할 수 있나요?
                    </button>
                </h2>
                <div id="faq4" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        네, 웹 버전은 서버에서 24시간 운영이 가능합니다. 백그라운드 모니터링도 지속적으로 동작하여 주문 상태 변화를 자동으로 확인합니다.
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq5">
                        Q: 데이터 백업은 어떻게 하나요?
                    </button>
                </h2>
                <div id="faq5" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        모든 데이터는 orders.db 파일에 저장됩니다. 이 파일을 정기적으로 백업하시면 됩니다. 클라우드 저장소나 외부 저장장치에 복사해두는 것을 권장합니다.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 연락처 -->
<div class="help-section">
    <div class="section-header">
        <h5 class="mb-0">
            <i class="fas fa-envelope"></i> 문의 및 지원
        </h5>
    </div>
    <div class="section-body">
        <p>추가 문의사항이 있으시면 아래 정보를 참고하세요:</p>
        <ul>
            <li><strong>시스템 버전</strong>: {{ version_info }}</li>
            <li><strong>업데이트</strong>: GitHub 저장소에서 최신 버전 확인</li>
            <li><strong>문제 신고</strong>: GitHub Issues 탭 활용</li>
        </ul>

        <div class="info-box">
            <strong><i class="fas fa-lightbulb"></i> 팁</strong><br>
            문제가 발생했을 때는 먼저 API 테스트 페이지에서 연결 상태를 확인해보세요. 대부분의 문제는 API 설정이나 네트워크 연결과 관련이 있습니다.
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
function toggleSection(sectionId) {
    const section = document.getElementById(sectionId);
    const header = section.previousElementSibling;
    const icon = header.querySelector('.fa-chevron-down, .fa-chevron-up');

    if (section.style.display === 'none' || section.style.display === '') {
        section.style.display = 'block';
        icon.classList.remove('fa-chevron-down');
        icon.classList.add('fa-chevron-up');
    } else {
        section.style.display = 'none';
        icon.classList.remove('fa-chevron-up');
        icon.classList.add('fa-chevron-down');
    }
}

// 페이지 로드시 첫 번째 섹션만 열기
document.addEventListener('DOMContentLoaded', function() {
    toggleSection('getting-started-body');
});

// URL 해시로 특정 섹션으로 이동
if (window.location.hash) {
    const targetSection = window.location.hash.substring(1);
    const element = document.getElementById(targetSection);
    if (element) {
        element.scrollIntoView();
        const bodyId = targetSection + '-body';
        const bodyElement = document.getElementById(bodyId);
        if (bodyElement && bodyElement.style.display === 'none') {
            toggleSection(bodyId);
        }
    }
}
</script>
{% endblock %}